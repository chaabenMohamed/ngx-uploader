!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngx-uploader",["exports","@angular/core","rxjs","rxjs/operators"],t):t((e=e||self)["ngx-uploader"]={},e.ng.core,e.rxjs,e.rxjs.operators)}(this,(function(e,t,n,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var o;function r(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s}function s(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function a(e){if(0===e)return"0 Byte";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB","PB"][t]}(o=e.UploadStatus||(e.UploadStatus={}))[o.Queue=0]="Queue",o[o.Uploading=1]="Uploading",o[o.Done=2]="Done",o[o.Cancelled=3]="Cancelled";var p=function(){function o(e,o,r,s){var u=this;void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===o&&(o=["*"]),void 0===r&&(r=Number.POSITIVE_INFINITY),void 0===s&&(s=Number.POSITIVE_INFINITY),this.queue=[],this.serviceEvents=new t.EventEmitter,this.uploadScheduler=new n.Subject,this.subs=[],this.contentTypes=o,this.maxUploads=r,this.maxFileSize=s,this.uploadScheduler.pipe(i.mergeMap((function(e){return u.startUpload(e)}),e)).subscribe((function(e){return u.serviceEvents.emit(e)}))}return o.prototype.handleFiles=function(e){var t,n=this,i=[].reduce.call(e,(function(e,t,i){var o=e.length+n.queue.length+1;if(n.isContentTypeAllowed(t.type)&&o<=n.maxUploads&&n.isFileSizeAllowed(t.size))e=e.concat(t);else{var r=n.makeUploadFile(t,i);n.serviceEvents.emit({type:"rejected",file:r})}return e}),[]);(t=this.queue).push.apply(t,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}([].map.call(i,(function(e,t){var i=n.makeUploadFile(e,t);return n.serviceEvents.emit({type:"addedToQueue",file:i}),i})))),this.serviceEvents.emit({type:"allAddedToQueue"})},o.prototype.initInputEvents=function(t){var n=this;return t.subscribe((function(t){switch(t.type){case"uploadFile":var i=n.queue.findIndex((function(e){return e===t.file}));-1!==i&&t.file&&n.uploadScheduler.next({file:n.queue[i],event:t});break;case"uploadAll":n.queue.filter((function(t){return t.progress.status===e.UploadStatus.Queue})).forEach((function(e){return n.uploadScheduler.next({file:e,event:t})}));break;case"cancel":var o=t.id||null;if(!o)return;n.subs.filter((function(e){return e.id===o})).forEach((function(t){if(t.sub){t.sub.unsubscribe();var i=n.queue.findIndex((function(e){return e.id===o}));-1!==i&&(n.queue[i].progress.status=e.UploadStatus.Cancelled,n.serviceEvents.emit({type:"cancelled",file:n.queue[i]}))}}));break;case"cancelAll":n.subs.forEach((function(t){t.sub&&t.sub.unsubscribe();var i=n.queue.find((function(e){return e.id===t.id}));i&&(i.progress.status=e.UploadStatus.Cancelled,n.serviceEvents.emit({type:"cancelled",file:i}))}));break;case"remove":if(!t.id)return;var r=n.queue.findIndex((function(e){return e.id===t.id}));if(-1!==r){var s=n.queue[r];n.queue.splice(r,1),n.serviceEvents.emit({type:"removed",file:s})}break;case"removeAll":n.queue.length&&(n.queue=[],n.serviceEvents.emit({type:"removedAll"}))}}))},o.prototype.startUpload=function(e){var t=this;return new n.Observable((function(n){var o=t.uploadFile(e.file,e.event).pipe(i.finalize((function(){n.closed||n.complete()}))).subscribe((function(e){n.next(e)}),(function(e){n.error(e),n.complete()}),(function(){n.complete()}));t.subs.push({id:e.file.id,sub:o})}))},o.prototype.uploadFile=function(t,i){var o=this;return new n.Observable((function(n){var r=i.url||"",s=i.method||"POST",u=i.data||{},p=i.headers||{},l=new XMLHttpRequest,d=(new Date).getTime(),c=t.progress.data&&t.progress.data.startTime||d,f=0,h=null;l.upload.addEventListener("progress",(function(i){if(i.lengthComputable){var r=Math.round(100*i.loaded/i.total),s=(new Date).getTime()-d;f=Math.round(i.loaded/s*1e3),c=t.progress.data&&t.progress.data.startTime||(new Date).getTime(),h=Math.ceil((i.total-i.loaded)/f),t.progress={status:e.UploadStatus.Uploading,data:{percentage:r,speed:f,speedHuman:a(f)+"/s",startTime:c,endTime:null,eta:h,etaHuman:o.secondsToHuman(h)}},n.next({type:"uploading",file:t})}}),!1),l.upload.addEventListener("error",(function(e){n.error(e),n.complete()})),l.onreadystatechange=function(){if(l.readyState===XMLHttpRequest.DONE){var i=Math.round(t.size/((new Date).getTime()-c)*1e3);t.progress={status:e.UploadStatus.Done,data:{percentage:100,speed:i,speedHuman:a(i)+"/s",startTime:c,endTime:(new Date).getTime(),eta:h,etaHuman:o.secondsToHuman(h||0)}},t.responseStatus=l.status;try{t.response=JSON.parse(l.response)}catch(e){t.response=l.response}t.responseHeaders=o.parseResponseHeaders(l.getAllResponseHeaders()),n.next({type:"done",file:t}),n.complete()}},l.open(s,r,!0),l.withCredentials=!!i.withCredentials;try{var v=t.nativeFile,m=o.queue.findIndex((function(e){return e.nativeFile===v}));o.queue[m].progress.status===e.UploadStatus.Cancelled&&n.complete(),Object.keys(p).forEach((function(e){return l.setRequestHeader(e,p[e])}));var y=void 0;!1!==i.includeWebKitFormBoundary?(Object.keys(u).forEach((function(e){return t.form.append(e,u[e])})),t.form.append(i.fieldName||"file",v,v.name),y=t.form):y=v,o.serviceEvents.emit({type:"start",file:t}),l.send(y)}catch(e){n.complete()}return function(){l.abort()}}))},o.prototype.secondsToHuman=function(e){return new Date(1e3*e).toISOString().substr(11,8)},o.prototype.generateId=function(){return Math.random().toString(36).substring(7)},o.prototype.setContentTypes=function(e){void 0!==e&&e instanceof Array?void 0!==e.find((function(e){return"*"===e}))?this.contentTypes=["*"]:this.contentTypes=e:this.contentTypes=["*"]},o.prototype.allContentTypesAllowed=function(){return void 0!==this.contentTypes.find((function(e){return"*"===e}))},o.prototype.isContentTypeAllowed=function(e){return!!this.allContentTypesAllowed()||void 0!==this.contentTypes.find((function(t){return t===e}))},o.prototype.isFileSizeAllowed=function(e){return!this.maxFileSize||e<=this.maxFileSize},o.prototype.makeUploadFile=function(t,n){return{fileIndex:n,id:this.generateId(),name:t.name,size:t.size,type:t.type,form:new FormData,progress:{status:e.UploadStatus.Queue,data:{percentage:0,speed:0,speedHuman:a(0)+"/s",startTime:null,endTime:null,eta:null,etaHuman:null}},lastModifiedDate:new Date(t.lastModified),sub:void 0,nativeFile:t}},o.prototype.parseResponseHeaders=function(e){if(e)return e.split("\n").map((function(e){return e.split(/: */,2)})).filter((function(e){return e[0]})).reduce((function(e,t){return e[t[0]]=t[1],e}),{})},o}(),l=function(){function e(e){this.elementRef=e,this.stopEvent=function(e){e.stopPropagation(),e.preventDefault()},this.uploadOutput=new t.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;this._sub=[];var n=this.options&&this.options.concurrency||Number.POSITIVE_INFINITY,i=this.options&&this.options.allowedContentTypes||["*"],o=this.options&&this.options.maxUploads||Number.POSITIVE_INFINITY,r=this.options&&this.options.maxFileSize||Number.POSITIVE_INFINITY;this.upload=new p(n,i,o,r),this.el=this.elementRef.nativeElement,this._sub.push(this.upload.serviceEvents.subscribe((function(t){e.uploadOutput.emit(t)}))),this.uploadInput instanceof t.EventEmitter&&this._sub.push(this.upload.initInputEvents(this.uploadInput)),this.el.addEventListener("drop",this.stopEvent,!1),this.el.addEventListener("dragenter",this.stopEvent,!1),this.el.addEventListener("dragover",this.stopEvent,!1)},e.prototype.ngOnDestroy=function(){this._sub.forEach((function(e){return e.unsubscribe()}))},e.prototype.onDrop=function(e){e.stopPropagation(),e.preventDefault();this.uploadOutput.emit({type:"drop"}),this.upload.handleFiles(e.dataTransfer.files)},e.prototype.onDragOver=function(e){if(e){this.uploadOutput.emit({type:"dragOver"})}},e.prototype.onDragLeave=function(e){if(e){this.uploadOutput.emit({type:"dragOut"})}},e.ctorParameters=function(){return[{type:t.ElementRef}]},r([t.Input(),s("design:type",Object)],e.prototype,"options",void 0),r([t.Input(),s("design:type",t.EventEmitter)],e.prototype,"uploadInput",void 0),r([t.Output(),s("design:type",t.EventEmitter)],e.prototype,"uploadOutput",void 0),r([t.HostListener("drop",["$event"]),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],e.prototype,"onDrop",null),r([t.HostListener("dragover",["$event"]),s("design:type",Function),s("design:paramtypes",[Event]),s("design:returntype",void 0)],e.prototype,"onDragOver",null),r([t.HostListener("dragleave",["$event"]),s("design:type",Function),s("design:paramtypes",[Event]),s("design:returntype",void 0)],e.prototype,"onDragLeave",null),e=r([t.Directive({selector:"[ngFileDrop]"}),s("design:paramtypes",[t.ElementRef])],e)}(),d=function(){function e(e){var n=this;this.elementRef=e,this.fileListener=function(){n.el.files&&n.upload.handleFiles(n.el.files)},this.uploadOutput=new t.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;this._sub=[];var n=this.options&&this.options.concurrency||Number.POSITIVE_INFINITY,i=this.options&&this.options.allowedContentTypes||["*"],o=this.options&&this.options.maxUploads||Number.POSITIVE_INFINITY,r=this.options&&this.options.maxFileSize||Number.POSITIVE_INFINITY;this.upload=new p(n,i,o,r),this.el=this.elementRef.nativeElement,this.el.addEventListener("change",this.fileListener,!1),this._sub.push(this.upload.serviceEvents.subscribe((function(t){e.uploadOutput.emit(t)}))),this.uploadInput instanceof t.EventEmitter&&this._sub.push(this.upload.initInputEvents(this.uploadInput))},e.prototype.ngOnDestroy=function(){this.el&&(this.el.removeEventListener("change",this.fileListener,!1),this._sub.forEach((function(e){return e.unsubscribe()})))},e.ctorParameters=function(){return[{type:t.ElementRef}]},r([t.Input(),s("design:type",Object)],e.prototype,"options",void 0),r([t.Input(),s("design:type",t.EventEmitter)],e.prototype,"uploadInput",void 0),r([t.Output(),s("design:type",t.EventEmitter)],e.prototype,"uploadOutput",void 0),e=r([t.Directive({selector:"[ngFileSelect]"}),s("design:paramtypes",[t.ElementRef])],e)}(),c=function(){function e(){}return e=r([t.NgModule({declarations:[l,d],exports:[l,d]})],e)}();e.NgFileDropDirective=l,e.NgFileSelectDirective=d,e.NgUploaderService=p,e.NgxUploaderModule=c,e.humanizeBytes=a,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-uploader.umd.min.js.map